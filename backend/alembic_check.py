import subprocessimport refrom datetime import datetime# Ejecuta "alembic check"def run_alembic_check():    cmd = subprocess.run(        ["alembic", "check"],        capture_output=True,        text=True    )    output = cmd.stdout + "\n" + cmd.stderr    return cmd.returncode, output# Parsea la salida del checkdef parse_changes(output):    tablas_agregadas = re.findall(r"Detected added table '([^']+)'", output)    tablas_removidas = re.findall(r"Detected removed table '([^']+)'", output)    return {        "tablas_agregadas": tablas_agregadas,        "tablas_removidas": tablas_removidas,    }# Crea una migración automáticadef create_migration():    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")    message = f"update_{timestamp}"    print(f"\n Creando migración: {message}\n")    subprocess.run([        "alembic",        "revision",        "--autogenerate",        "-m",        message    ])# Sube la evolución a HEADdef upgrade_head():    print("\n Actualizando base de datos (upgrade head)...\n")    subprocess.run([        "alembic",        "upgrade",        "head"    ])def main():    print("\n=== ALEMBIC AUTO CHECK ===\n")    returncode, output = run_alembic_check()    print("SALIDA COMPLETA:")    print(output)    print("--------------------------\n")    if returncode == 0:        print(" No hay cambios pendientes.\n")        return    print(" Hay cambios detectados:\n")    cambios = parse_changes(output)    print("Tablas agregadas:", cambios["tablas_agregadas"])    print("Tablas removidas:", cambios["tablas_removidas"])    option = input("\n Deseas generar una migración automática? (y/n): ").lower()    if option == "y":        create_migration()        upgrade_head()        print("\n Migración generada y actualizada.\n")    else:        print("\n Operación cancelada por el usuario.\n")if __name__ == "__main__":    main()